// Module XÃ¬ DÃ¡ch - Casino NhÃ  Thanh 
module.exports.config = { name: "xidach", version: "1.0.0", hasPermssion: 0, credits: "Dat Thanh", description: "ChÆ¡i xÃ¬ dÃ¡ch cÃ¹ng báº¡n bÃ¨", commandCategory: "game", usages: "/xidach <create|join|rÃºt|dáº±n|xá»•>", cooldowns: 10 };

const games = {}; const suits = ['â™ ï¸', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸']; const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

function createDeck() { let deck = []; for (let suit of suits) { for (let value of values) { deck.push({ suit, value }); } } return shuffle(deck); }

function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }

function calculatePoints(hand) { let points = 0; let aceCount = 0; for (let card of hand) { if (card.value === 'A') { aceCount++; points += 11; } else if (['K', 'Q', 'J'].includes(card.value)) { points += 10; } else { points += parseInt(card.value); } } while (points > 21 && aceCount > 0) { points -= 10; aceCount--; } return points; }

module.exports.run = async function({ api, event, args, Currencies }) { const { threadID, messageID, senderID } = event; const type = args[0]; if (!type) return api.sendMessage("[Casino NhÃ  Thanh] HÃ£y dÃ¹ng lá»‡nh: /xidach <create|join|rÃºt|dáº±n|xá»•>", threadID, messageID);

if (!games[threadID]) games[threadID] = null;

switch (type) { case "create": { if (games[threadID]) return api.sendMessage("ÄÃ£ cÃ³ bÃ n Ä‘ang chÆ¡i, hÃ£y /xidach join!", threadID, messageID); const bet = parseInt(args[1]); if (isNaN(bet) || bet <= 0) return api.sendMessage("HÃ£y nháº­p sá»‘ tiá»n cÆ°á»£c há»£p lá»‡.", threadID, messageID); games[threadID] = { deck: createDeck(), bet, players: { [senderID]: { hand: [], status: 'playing' } }, started: true }; games[threadID].players[senderID].hand.push(games[threadID].deck.pop()); games[threadID].players[senderID].hand.push(games[threadID].deck.pop()); return api.sendMessage("[â™ ï¸ Casino NhÃ  Thanh â™ ï¸]\nBáº¡n Ä‘Ã£ táº¡o bÃ n XÃ¬ DÃ¡ch vá»›i cÆ°á»£c: " + bet + "\nGÃµ /xidach join Ä‘á»ƒ tham gia!", threadID); } case "join": { const game = games[threadID]; if (!game) return api.sendMessage("ChÆ°a cÃ³ bÃ n nÃ o, hÃ£y táº¡o báº±ng /xidach create <tiá»n>.", threadID, messageID); if (game.players[senderID]) return api.sendMessage("Báº¡n Ä‘Ã£ tham gia bÃ n nÃ y rá»“i.", threadID, messageID); game.players[senderID] = { hand: [], status: 'playing' }; game.players[senderID].hand.push(game.deck.pop()); game.players[senderID].hand.push(game.deck.pop()); return api.sendMessage("Tham gia bÃ n chÆ¡i thÃ nh cÃ´ng! GÃµ /xidach rÃºt hoáº·c /xidach dáº±n.", threadID); } case "rÃºt": { const game = games[threadID]; if (!game || !game.players[senderID]) return api.sendMessage("Báº¡n chÆ°a tham gia bÃ n chÆ¡i nÃ o.", threadID); if (game.players[senderID].status !== 'playing') return api.sendMessage("Báº¡n Ä‘Ã£ dáº±n rá»“i.", threadID); game.players[senderID].hand.push(game.deck.pop()); return api.sendMessage("RÃºt thÃªm bÃ i thÃ nh cÃ´ng.", threadID); } case "dáº±n": { const game = games[threadID]; if (!game || !game.players[senderID]) return api.sendMessage("Báº¡n chÆ°a tham gia bÃ n chÆ¡i nÃ o.", threadID); game.players[senderID].status = 'stand'; return api.sendMessage("Báº¡n Ä‘Ã£ dáº±n bÃ i.", threadID); } case "xá»•": { const game = games[threadID]; if (!game) return api.sendMessage("ChÆ°a cÃ³ bÃ n chÆ¡i nÃ o.", threadID); const results = []; let winner = null; let max = 0; for (let uid in game.players) { const p = game.players[uid]; const point = calculatePoints(p.hand); results.push({ uid, point }); if (point <= 21 && point > max) { max = point; winner = uid; } } let msg = "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n       â™ ï¸ Xá»” XÃŒ DÃCH â™ ï¸\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"; for (let r of results) { msg += â€¢ UID ${r.uid}: ${r.point} Ä‘iá»ƒm\n; } if (winner) { msg += \nğŸ¥‡ NgÆ°á»i tháº¯ng: ${winner} (${max} Ä‘iá»ƒm)\n+${game.bet * (Object.keys(game.players).length - 1)} VNÄ; } else { msg += "\nKhÃ´ng ai tháº¯ng vÃ¬ Ä‘á»u quÃ¡ 21 Ä‘iá»ƒm!"; } delete games[threadID]; return api.sendMessage(msg + "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", threadID); } default: return api.sendMessage("Lá»‡nh khÃ´ng há»£p lá»‡, hÃ£y dÃ¹ng /xidach <create|join|rÃºt|dáº±n|xá»•>", threadID); } };

